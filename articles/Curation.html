<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="flowFate">
<title>Data Curation • flowFate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Curation">
<meta property="og:description" content="flowFate">
<meta property="og:image" content="https://maximesunnen.github.io/flowFate/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">flowFate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Curation.html">Data Curation</a>
    <a class="dropdown-item" href="../articles/Data-import.html">Data-import</a>
    <a class="dropdown-item" href="../articles/app-dockerisation.html">App Dockerisation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/maximesunnen/flowFate/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Data Curation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/maximesunnen/flowFate/blob/HEAD/vignettes/Curation.Rmd" class="external-link"><code>vignettes/Curation.Rmd</code></a></small>
      <div class="d-none name"><code>Curation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="gating-live-cells">Gating live cells<a class="anchor" aria-label="anchor" href="#gating-live-cells"></a>
</h2>
<p>Preparing samples for flow cytometry inevitably lead to the formation
of damaged or dead cells (also called “debris”) that need to be excluded
from the analysis. Conveniently, we can distinguish such cells in a SSC
vs FSC plot and remove them with appropriate gates.</p>
<p>In flowFate, we remove debris with a “hard” gate (FIGURE!!!). This
means that the gate boundaries are <strong>predefined</strong> and users
are not able to manually change them. This needs to be considered during
acquisition to ensure that intact cells accumulate in this pre-defined
window.</p>
<p><strong>Note:</strong> Advanced R users could nevertheless manually
adjust these gate boundaries by changing the respective gating matrix in
the source code.</p>
<div class="section level3">
<h3 id="setting-up-the-gate-matrix">1) Setting up the gate matrix<a class="anchor" aria-label="anchor" href="#setting-up-the-gate-matrix"></a>
</h3>
<p>We first need to set up a m x n gate matrix:</p>
<ul>
<li><p><strong>n</strong>, the number of columns, corresponds to the
gating dimensions (here n = 2 since cells are gated based on their
location in a 2D SSC vs FSC plot)</p></li>
<li><p><strong>m</strong>, the number of rows, corresponds to the number
of individual points that make up the rectangle gate.</p></li>
</ul>
<p>Each row should then contain the X and Y coordinates (in the first
and second column of the matrix, respectively) of the latter points. We
then rename the columns to match the gating dimensions. Since the FSC
and SSC channels change depending on the flow cytometer, the user can
select the appropriate channel names and the columns of the gate matrix
are adapted based on this selection.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creating the gate matrix</span></span>
<span><span class="va">pgn_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12500</span>, <span class="fl">99000</span>, <span class="fl">99000</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">6250</span>, <span class="fl">6250</span>, <span class="fl">99000</span>, <span class="fl">99000</span>,<span class="fl">12500</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># renaming the columns to match the gating dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pgn_cut</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Side scatter"</span>, <span class="st">"Forward scatter"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      Side scatter Forward scatter</span></span>
<span><span class="co">#&gt; [1,]        12500            6250</span></span>
<span><span class="co">#&gt; [2,]        99000            6250</span></span>
<span><span class="co">#&gt; [3,]        99000           99000</span></span>
<span><span class="co">#&gt; [4,]            0           99000</span></span>
<span><span class="co">#&gt; [5,]            0           12500</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="create-the-gate">2) Create the gate<a class="anchor" aria-label="anchor" href="#create-the-gate"></a>
</h3>
<p>We create the gate using flowCore’s <code><a href="https://rdrr.io/pkg/flowCore/man/polygonGate-class.html" class="external-link">polygonGate( )</a></code>
function. The filterId argument uniquely identifies the generated
gate.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gate_non_debris</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="fu">polygonGate</span><span class="op">(</span>filterId <span class="op">=</span> <span class="st">"NonDebris"</span>, .gate <span class="op">=</span> <span class="va">pgn_cut</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="apply-the-gate-to-the-gatingset">3) Apply the gate to the GatingSet<a class="anchor" aria-label="anchor" href="#apply-the-gate-to-the-gatingset"></a>
</h3>
<p>Up to now, we have only created a gate from a gate matrix. To
<strong>add</strong> this gate to the GatingSet (<code>r$gs</code>,
created during data import (reference to import vignette and section)),
we use <code>gs_pop_add( )</code>. Recomputing <code>r$gs</code> with
<code>recompute( )</code>, we <strong>apply</strong> the gate to our
data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gs_pop_add</span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">gs</span>, <span class="fu">gate_non_debris</span><span class="op">(</span><span class="op">)</span>, parent <span class="op">=</span> <span class="st">"root"</span><span class="op">)</span></span>
<span><span class="fu">recompute</span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">gs</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="gating-gfp-cells">Gating GFP+ cells<a class="anchor" aria-label="anchor" href="#gating-gfp-cells"></a>
</h2>
<p>flowFate was mainly developed to study the effect transfection of
GFP-labeled KRas constructs has on C2C12 differentiation. Our analyis
should therefore be focused on transfected cells only. Untransfected
cells however, due to background noise and autofluorescence, can also
emit fluorescence captured in the green channel of our flow cytometer.
To distinguish transfected from untransfected cells, we apply a GFP
threshold to our data so that cells below a certain threshold intensity
are removed from further analysis.</p>
<p>To determine the value of this threshold, we use:</p>
<ul>
<li><p>a <strong>double-negative control</strong> sample: untransfected,
unlabelled C2C12</p></li>
<li><p>a <strong>MyHC-only control</strong> sample: untransfected C2C12,
labelled with an antibody against myosin heavy-chain (MyHC)</p></li>
</ul>
<p>For both control samples, the observed GFP signal (green channel of
the flow cytometer) is unspecific and is illustrated below.</p>
<p>SCREENSHOT</p>
<p>The key idea here is to determine a GFP threshold for which most of
the cells in these two controls samples would be below this threshold.
We then use this threshold to create a gate that only keeps cells if
they are <strong>above</strong> this threshold, i.e the GFP signal is
specific.</p>
<div class="section level3">
<h3 id="determine-a-gfp-threshold-intensity">1) Determine a GFP threshold intensity<a class="anchor" aria-label="anchor" href="#determine-a-gfp-threshold-intensity"></a>
</h3>
<p>Most of the work here is wrapped into a custom function
<code>get_lowerLimit( )</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_lowerLimit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">gs</span>, <span class="va">datasets</span>, <span class="va">node</span>, <span class="va">ch_gate</span>, <span class="va">r</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span>  <span class="co"># extract the data from the two control samples as a flowSet</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">gs_pop_get_data</span><span class="op">(</span><span class="va">r</span><span class="op">$</span><span class="va">gs</span><span class="op">[[</span><span class="va">datasets</span><span class="op">]</span><span class="op">]</span>, <span class="va">node</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">cytoset_to_flowSet</span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># for each dataset of the extracted flowSet, create a quantile gate using the correct channel name (in our case this will be the name of the GFP channel selected by the user)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/fsApply.html" class="external-link">fsApply</a></span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fr</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">openCyto</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gate_quantile.html" class="external-link">gate_quantile</a></span><span class="op">(</span><span class="va">fr</span>, channel <span class="op">=</span> <span class="va">ch_gate</span>, probs <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># return the average of two quantile gate's lower limit</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">min</span>, <span class="va">y</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">min</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lower_limit_gfp_gate</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">get_lowerLimit</span><span class="op">(</span>gs <span class="op">=</span> <span class="va">r</span><span class="op">$</span><span class="va">gs</span>, datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">negative_control</span>, <span class="va">input</span><span class="op">$</span><span class="va">positive_control_myhc</span><span class="op">)</span>, node <span class="op">=</span> <span class="st">"NonDebris"</span>, ch_gate <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">kras_channel</span>, r <span class="op">=</span> <span class="va">r</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">bindEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">Curate</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">create_quantile_gate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">samples</span>, <span class="va">gate_channel</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">flowCore</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/fsApply.html" class="external-link">fsApply</a></span><span class="op">(</span><span class="va">samples</span>, <span class="kw">function</span><span class="op">(</span><span class="va">fr</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fr</span><span class="op">)</span></span>
<span>    <span class="fu">openCyto</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openCyto/man/gate_quantile.html" class="external-link">gate_quantile</a></span><span class="op">(</span><span class="va">fr</span>, channel <span class="op">=</span> <span class="va">gate_channel</span>, probs <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Maxime Sünnen, Aurélien Ginolhac.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
